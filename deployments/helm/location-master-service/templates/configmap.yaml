apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "location-master-service.fullname" . }}-config
  labels:
    {{- include "location-master-service.labels" . | nindent 4 }}
data:
  # Spring Configuration
  SPRING_APPLICATION_NAME: "location-master-service"

  # Database Configuration
  SPRING_DATASOURCE_URL: {{ include "location-master-service.databaseUrl" . | quote }}
  SPRING_DATASOURCE_USERNAME: {{ .Values.database.username | quote }}
  SPRING_DATASOURCE_DRIVER_CLASS_NAME: "org.postgresql.Driver"

  # JPA Configuration
  SPRING_JPA_HIBERNATE_DDL_AUTO: "validate"
  SPRING_JPA_SHOW_SQL: "false"
  SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT: "org.hibernate.dialect.PostgreSQLDialect"

  # Kafka Configuration
  SPRING_KAFKA_BOOTSTRAP_SERVERS: {{ .Values.kafka.bootstrapServers | quote }}
  SPRING_KAFKA_PRODUCER_KEY_SERIALIZER: "org.apache.kafka.common.serialization.StringSerializer"
  SPRING_KAFKA_PRODUCER_VALUE_SERIALIZER: "org.springframework.kafka.support.serializer.JsonSerializer"
  SPRING_KAFKA_CONSUMER_GROUP_ID: {{ .Values.kafka.consumerGroup | quote }}
  SPRING_KAFKA_CONSUMER_AUTO_OFFSET_RESET: "earliest"
  SPRING_KAFKA_CONSUMER_KEY_DESERIALIZER: "org.apache.kafka.common.serialization.StringDeserializer"
  SPRING_KAFKA_CONSUMER_VALUE_DESERIALIZER: "org.springframework.kafka.support.serializer.JsonDeserializer"

  # CloudEvents Configuration
  CLOUDEVENTS_KAFKA_TOPIC: {{ .Values.kafka.topic | quote }}
  CLOUDEVENTS_KAFKA_SOURCE: "/wms/location-master-service"

  # Application Configuration
  LOCATION_SLOTTING_ENABLED: {{ .Values.config.location.slotting.enabled | quote }}
  LOCATION_SLOTTING_AUTO_OPTIMIZE: {{ .Values.config.location.slotting.autoOptimize | quote }}
  LOCATION_HIERARCHY_MAX_DEPTH: {{ .Values.config.location.hierarchy.maxDepth | quote }}

  # Actuator Configuration
  MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "health,info,metrics,prometheus"
  MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "when-authorized"
  MANAGEMENT_HEALTH_DB_ENABLED: "true"
  MANAGEMENT_HEALTH_KAFKA_ENABLED: "true"
  MANAGEMENT_METRICS_EXPORT_PROMETHEUS_ENABLED: "true"
  MANAGEMENT_METRICS_TAGS_APPLICATION: "location-master-service"
  MANAGEMENT_METRICS_TAGS_ENVIRONMENT: "kubernetes"
  MANAGEMENT_METRICS_TAGS_SERVICE_TYPE: "wms"

  {{- if .Values.observability.tracing.enabled }}
  # OpenTelemetry Tracing Configuration
  MANAGEMENT_TRACING_SAMPLING_PROBABILITY: {{ .Values.observability.tracing.samplingProbability | quote }}
  MANAGEMENT_OTLP_TRACING_ENDPOINT: {{ .Values.observability.tracing.endpoint | quote }}
  {{- end }}

  # Logging Configuration
  LOGGING_LEVEL_ROOT: "INFO"
  LOGGING_LEVEL_COM_PAKLOG_WMS_LOCATION: "INFO"
  LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_KAFKA: "WARN"
  LOGGING_LEVEL_ORG_HIBERNATE_SQL: "WARN"
