<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Capacity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">location-master-service</a> &gt; <a href="index.source.html" class="el_package">com.paklog.wms.location.domain.entity</a> &gt; <span class="el_source">Capacity.java</span></div><h1>Capacity.java</h1><pre class="source lang-java linenums">package com.paklog.wms.location.domain.entity;

import jakarta.persistence.Embeddable;
import java.math.BigDecimal;
import java.math.RoundingMode;

/**
 * Capacity - Location capacity management
 */
@Embeddable
public class Capacity {
    private Integer maxQuantity;
    private BigDecimal maxWeight;
    private BigDecimal maxVolume;
    private String weightUnit; // KG, LB
    private String volumeUnit; // M3, FT3

    private Integer currentQuantity;
    private BigDecimal currentWeight;
    private BigDecimal currentVolume;

<span class="fc" id="L22">    protected Capacity() {</span>
        // JPA constructor
<span class="fc" id="L24">    }</span>

    public Capacity(Integer maxQuantity, BigDecimal maxWeight, BigDecimal maxVolume,
<span class="fc" id="L27">                   String weightUnit, String volumeUnit) {</span>
<span class="pc bpc" id="L28" title="1 of 4 branches missed.">        if (maxQuantity == null || maxQuantity &lt;= 0) {</span>
<span class="fc" id="L29">            throw new IllegalArgumentException(&quot;Max quantity must be positive&quot;);</span>
        }
<span class="pc bpc" id="L31" title="1 of 4 branches missed.">        if (maxWeight == null || maxWeight.compareTo(BigDecimal.ZERO) &lt;= 0) {</span>
<span class="fc" id="L32">            throw new IllegalArgumentException(&quot;Max weight must be positive&quot;);</span>
        }
<span class="pc bpc" id="L34" title="1 of 4 branches missed.">        if (maxVolume == null || maxVolume.compareTo(BigDecimal.ZERO) &lt;= 0) {</span>
<span class="fc" id="L35">            throw new IllegalArgumentException(&quot;Max volume must be positive&quot;);</span>
        }

<span class="fc" id="L38">        this.maxQuantity = maxQuantity;</span>
<span class="fc" id="L39">        this.maxWeight = maxWeight;</span>
<span class="fc" id="L40">        this.maxVolume = maxVolume;</span>
<span class="pc bpc" id="L41" title="1 of 2 branches missed.">        this.weightUnit = weightUnit != null ? weightUnit : &quot;KG&quot;;</span>
<span class="pc bpc" id="L42" title="1 of 2 branches missed.">        this.volumeUnit = volumeUnit != null ? volumeUnit : &quot;M3&quot;;</span>

<span class="fc" id="L44">        this.currentQuantity = 0;</span>
<span class="fc" id="L45">        this.currentWeight = BigDecimal.ZERO;</span>
<span class="fc" id="L46">        this.currentVolume = BigDecimal.ZERO;</span>
<span class="fc" id="L47">    }</span>

    /**
     * Check if can accept additional quantity
     */
    public boolean canAccept(int quantity, BigDecimal weight, BigDecimal volume) {
<span class="fc bfc" id="L53" title="All 2 branches covered.">        if (currentQuantity + quantity &gt; maxQuantity) {</span>
<span class="fc" id="L54">            return false;</span>
        }
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">        if (currentWeight.add(weight).compareTo(maxWeight) &gt; 0) {</span>
<span class="nc" id="L57">            return false;</span>
        }
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">        if (currentVolume.add(volume).compareTo(maxVolume) &gt; 0) {</span>
<span class="nc" id="L60">            return false;</span>
        }
<span class="fc" id="L62">        return true;</span>
    }

    /**
     * Add inventory to location
     */
    public void addInventory(int quantity, BigDecimal weight, BigDecimal volume) {
<span class="fc bfc" id="L69" title="All 2 branches covered.">        if (!canAccept(quantity, weight, volume)) {</span>
<span class="fc" id="L70">            throw new IllegalStateException(&quot;Location does not have sufficient capacity&quot;);</span>
        }

<span class="fc" id="L73">        this.currentQuantity += quantity;</span>
<span class="fc" id="L74">        this.currentWeight = this.currentWeight.add(weight);</span>
<span class="fc" id="L75">        this.currentVolume = this.currentVolume.add(volume);</span>
<span class="fc" id="L76">    }</span>

    /**
     * Remove inventory from location
     */
    public void removeInventory(int quantity, BigDecimal weight, BigDecimal volume) {
<span class="fc bfc" id="L82" title="All 2 branches covered.">        if (currentQuantity &lt; quantity) {</span>
<span class="fc" id="L83">            throw new IllegalStateException(&quot;Cannot remove more quantity than available&quot;);</span>
        }

<span class="fc" id="L86">        this.currentQuantity -= quantity;</span>
<span class="fc" id="L87">        this.currentWeight = this.currentWeight.subtract(weight);</span>
<span class="fc" id="L88">        this.currentVolume = this.currentVolume.subtract(volume);</span>

        // Ensure no negative values
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">        if (this.currentWeight.compareTo(BigDecimal.ZERO) &lt; 0) {</span>
<span class="nc" id="L92">            this.currentWeight = BigDecimal.ZERO;</span>
        }
<span class="pc bpc" id="L94" title="1 of 2 branches missed.">        if (this.currentVolume.compareTo(BigDecimal.ZERO) &lt; 0) {</span>
<span class="nc" id="L95">            this.currentVolume = BigDecimal.ZERO;</span>
        }
<span class="fc" id="L97">    }</span>

    /**
     * Calculate utilization percentage
     */
    public BigDecimal getUtilizationPercentage() {
<span class="pc bpc" id="L103" title="1 of 2 branches missed.">        if (maxQuantity == 0) {</span>
<span class="nc" id="L104">            return BigDecimal.ZERO;</span>
        }

<span class="fc" id="L107">        BigDecimal quantityPct = new BigDecimal(currentQuantity)</span>
<span class="fc" id="L108">            .multiply(new BigDecimal(&quot;100&quot;))</span>
<span class="fc" id="L109">            .divide(new BigDecimal(maxQuantity), 2, RoundingMode.HALF_UP);</span>

<span class="fc" id="L111">        BigDecimal weightPct = currentWeight</span>
<span class="fc" id="L112">            .multiply(new BigDecimal(&quot;100&quot;))</span>
<span class="fc" id="L113">            .divide(maxWeight, 2, RoundingMode.HALF_UP);</span>

<span class="fc" id="L115">        BigDecimal volumePct = currentVolume</span>
<span class="fc" id="L116">            .multiply(new BigDecimal(&quot;100&quot;))</span>
<span class="fc" id="L117">            .divide(maxVolume, 2, RoundingMode.HALF_UP);</span>

        // Return maximum of the three percentages
<span class="fc" id="L120">        return quantityPct.max(weightPct).max(volumePct);</span>
    }

    /**
     * Check if location is full (&gt;95% utilization)
     */
    public boolean isFull() {
<span class="fc bfc" id="L127" title="All 2 branches covered.">        return getUtilizationPercentage().compareTo(new BigDecimal(&quot;95&quot;)) &gt;= 0;</span>
    }

    /**
     * Check if location is near capacity (&gt;80% utilization)
     */
    public boolean isNearCapacity() {
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">        return getUtilizationPercentage().compareTo(new BigDecimal(&quot;80&quot;)) &gt;= 0;</span>
    }

    /**
     * Get available quantity
     */
    public int getAvailableQuantity() {
<span class="fc" id="L141">        return maxQuantity - currentQuantity;</span>
    }

    /**
     * Get available weight
     */
    public BigDecimal getAvailableWeight() {
<span class="fc" id="L148">        return maxWeight.subtract(currentWeight);</span>
    }

    /**
     * Get available volume
     */
    public BigDecimal getAvailableVolume() {
<span class="fc" id="L155">        return maxVolume.subtract(currentVolume);</span>
    }

    // Getters
    public Integer getMaxQuantity() {
<span class="fc" id="L160">        return maxQuantity;</span>
    }

    public BigDecimal getMaxWeight() {
<span class="fc" id="L164">        return maxWeight;</span>
    }

    public BigDecimal getMaxVolume() {
<span class="fc" id="L168">        return maxVolume;</span>
    }

    public String getWeightUnit() {
<span class="fc" id="L172">        return weightUnit;</span>
    }

    public String getVolumeUnit() {
<span class="fc" id="L176">        return volumeUnit;</span>
    }

    public Integer getCurrentQuantity() {
<span class="fc" id="L180">        return currentQuantity;</span>
    }

    public BigDecimal getCurrentWeight() {
<span class="fc" id="L184">        return currentWeight;</span>
    }

    public BigDecimal getCurrentVolume() {
<span class="fc" id="L188">        return currentVolume;</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L193">        return String.format(&quot;Capacity[qty=%d/%d, weight=%s/%s %s, volume=%s/%s %s, util=%s%%]&quot;,</span>
            currentQuantity, maxQuantity,
            currentWeight, maxWeight, weightUnit,
            currentVolume, maxVolume, volumeUnit,
<span class="nc" id="L197">            getUtilizationPercentage());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>